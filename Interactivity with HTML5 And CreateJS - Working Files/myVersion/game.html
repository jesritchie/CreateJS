<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CreateJS export from game.fla</title>

<script src="libs/easeljs-0.4.2.min.js"></script>
<script src="libs/tweenjs-0.2.0.min.js"></script>
<script src="libs/movieclip-0.4.1.min.js"></script>
<script src="libs/preloadjs-0.1.0.min.js"></script>
<script src="libs/soundjs-0.2.0.min.js"></script>
<script src="game.js"></script>

<script>

var canvas, stage, exportRoot;
var inPlay; //to know when game is playing
var egg;//will be used for canvas egg
var splat;//will be used for canvas egg splat
var gOver;//determine when game is over
var score;//this will update the score
//================== H E R O E S   V A R I A B L E S =========================\\
var hero;//this is the var for the little blue monster
var walkPos;//this will hold the postion that the hero will walk towards
var moving;//this will control whether or not the hero is moving
//============================================================================\\
//=================== E N E M Y    V A R I A B L E S =========================\\
var enemy;//this is the var for the traidactul -> bird.
var aTime = 0;//attack time is a count that will count u how often to attack
var aFreq;//how often to attack
var attackSpeed;//speed of the attack itself
var ePosX = [-95, -95, 100, 900, 1100];
var ePosY = [90, 180, -75, -75, 0];
var eEgg = false;
//============================================================================\\

//============= E G G   C O N T R O L    V A R I A B L E S ===================\\
var eggDrop = false;
//============================================================================\\
function init() {
	canvas = document.getElementById("canvas");
    //preload sounds into manifest.
	var manifest = [
		{src:"sounds/splat.mp3", id:"splat_1"}
	];

	var loader = new PreloadJS(false);
	loader.installPlugin(SoundJS);
	//function is called when the loader completes loading the .mp3 into the manifest.
	loader.onComplete = handleComplete;
	loader.loadManifest(manifest);
}

//At this point everything is ready and game programming can commence.
function handleComplete() {
//exportRoot is the image canvas itself
	exportRoot = new lib.game();
	egg = exportRoot.egg;      // short hand for egg
	splat = exportRoot.splat;  // short hand for splat
 	gOver = exportRoot.gOver;  // short hand for gameOver tittle
  hero = exportRoot.monster; // short hand for my hero
	enemy = exportRoot.bird; // short hand for the enemy
	enemy.onClick = eClick; //enemy click

// make a clickable element which will be the ground
// so that upon clicking on the ground the hero will move to the postion clicked
// and stop on the click postion on the ground itself.

// To do the above link the export route -> ground -> onClick
exportRoot.ground.onClick = groundClick;

	//short hand ref for vars
	stage = new Stage(canvas);
	stage.addChild(exportRoot);
	setTitle();
	//Change the screen
	stage.update();

  //Tick is something that happens every frame pre second
	Ticker.setFPS(30);
	Ticker.addListener(window); //sets the ticker to look in this
	                           //window for a function named tick
}

function playSound(name, loop) {
	SoundJS.play(name, SoundJS.INTERRUPT_EARLY, 0, 0, loop);
}

function setTitle(){
	//make the button now click-able
	exportRoot.title.button.onClick = startClick;
	gOver.visible = false //hide game over text
	//move the egg off the srceen -> well its still on just not in the canvas element
	//moved slightly above and to the left
	egg.x = -100;
	egg.y = -100;
	//hide the splat as well
	//moved farther to the left then the egg since it is slightly larger
	//550 down is actually where it is going to splat on the ground
	//will only ever need to move it on the x-axis when it hits the ground
	splat.x = -200;
	splat.y = 550;
	//initialize the Score
	score = 0;
	//======================== H E R O =========================================\\
	//initialize the walk postion
	walkPos = hero.x; // sets walk to heroes x position
	moving = false; //initialize moving as no
	//==========================================================================\\
	//======================== E N E M Y =======================================\\
	aFreq = 350; //fequency set every 350 frames
	attackSpeed = 4000;//attack speed will take 4 seconds.
	var p = Math.round(Math.random()*4) // random start location
	enemy.x = ePosX[p];
	enemy.y = ePosY[p];
	//==========================================================================\\
}
//enventObj lets CreateJS know that there is a event taking place
//the click of a button
function startClick(eventObj){
	//first thing the title screen to disappear
	exportRoot.title.visible=false;
	//make button no longer clickable
	//set inPlay to true since game is now active
	inPlay = true;

	//set enemy to attack straight away
	eAttack();
}

//Ground Click function
function groundClick(eventObj){
	//event taking place in create js
	//console.log(eventObj.stageX);
	walkPos = eventObj.stageX;
	//now moving
	moving = true;

	//adding animation
	hero.gotoAndStop("walk"); //this is works because its based on the
	 											    //flash framework easy eh
}

//tick function to be called by Ticker
function tick(eventObj){
	//as it runs detect if the game is playing or not
	if (inPlay){//if it is do game stuff...
		heroMove(); // moves the hero
		enemyManager(); // manages the enemy
		eggControl();// manages the enemy egg
		exportRoot.score.text=score; //update score.
	}
	stage.update(); // update the stage to make stuff happen
}

//function for moving the heroes
function heroMove(){
		if (moving){ //hero is moving
				//Step 1) determine if the ground has been clicked to the
				//left or the right of the hero
				if (walkPos < hero.x){//Move Left
					//step 2) remove pixels from hero each frame
					hero.x -= 7; //take 7 px off the x position of the hero every frame
											 //this will give the illusion of movement
					//step 3) change direction the hero faces.
					hero.scaleX = -1.75; //Due to hero export at 175% scale must match at 1.75
														//Normally .scaleX would be -1 to flip
				}
				else{ //Move Right
					//step 2) add pixels from hero each frame
					hero.x += 7; //add 7 px to the x position of the hero every frame
											 //this will give the illusion of movement
					//step 3) change direction the hero faces.
					hero.scaleX = 1.75; //Due to hero export at 175% scale must match at 1.75
														//Normally .scaleX would be 1 to flip
			}
			var diff = walkPos-hero.x; //the difference
			if(diff <= 5.1 && diff >-5.1){ //approximately at the postion that hero should stop
				moving = false;
				hero.gotoAndStop("idle");//stops character from walking and now is idle
			}
		}

}
function enemyManager(){ //looks after how often to attack
	aTime ++; //incease attack time by one
	if (aTime > aFreq){ //time to attack
		//console.log("attack!");
		eAttack(); //enemy Attack
		aTime = 0; //reset attack time
	}
}
function eAttack(){

	eEgg = false;// ensure egg is invasiabe.
	enemy.scaleX = -1.3;//flip the enemy in oppiste direction
											 // enemy scale up 130 % hence 1.3
	//Add a TWEEN
	//create a tween to each point x:450, y:450  pixels , which is roughly the
	//center of the stage
	//Next -> the time it will take is 4500 milliseconds i.e 4.5 seconds
	//Then its going to use the ease of sine out which means it will get there
	//slower as it gets to the end
	Tween.get(enemy).to({x:450, y:450}, 4500, Ease.sineOut).call(eEscape);	//eEscape will move enemy back out

}
function eEscape(){ // escaping after getting an egg.
	eEgg = true;// shows the enemy carrying the egg
	enemy.scaleX = 1.3;// flip the enemy
	var p = Math.round(Math.random()*4); //generate random number between 0-3
	//that number is going to choose the enemys random escape
	//ePosX ePosY will hold random escape postions for enemey
	Tween.get(enemy).to({x:ePosX[p], y: ePosY[p]}, attackSpeed, Ease.sineOut);

}
function eggControl(){ //controls enemys egg
	enemy.egg.visible = eEgg;
	if (eggDrop){//drop the egg
			egg.y += 4; //move the egg down towards the ground
			if(egg.y > 550){//egg has reach the ground.
				//now get rid of the egg
				egg.x = -100; //hide off the screen again
				egg.y = - 100; //hide off the screen again
				eggDrop = false;
				//add a splat
			}
	}
}
function eClick(eventObj){ //control for when enemy is clicked
	if(eEgg){ //enemy has an egg showing
		eEgg = false;
		//add the egg at the enemys current location
		egg.x = this.x;
		egg.y = this.y;
		//drop the egg to the ground
		eggDrop = true;
		//update Score
		score += 10;
	}

}
</script>
</head>

<body onload="init();" style="background-color:#D4D4D4">
	<canvas id="canvas" width="900" height="600" style="background-color:#bdecec"></canvas>
</body>
</html>
